---
author: mestew
ms.author: mstewart
ms.prod: configuration-manager
ms.technology: configmgr-other
ms.topic: include
ms.date: 02/13/2020
---

## <a name="bkmk_365"></a> Office 365 updates for disconnected software update points
<!--4065163-->
You can use a new tool to import Office 365 updates from an internet connected WSUS server into a disconnected Configuration Manager environment. Previously when you exported and imported metadata for software updated in disconnected environments, you were unable to deploy Office 365 updates. Office 365 updates require additional metadata downloaded from an Office API and the Office CDN which isn't possible for disconnected environments.

### Prerequisites

- An internet connected WSUS server running a minimum of Windows Server 2012.
- The WSUS server needs connectivity to these two internet endpoints:
   - `officecdn.microsoft.com`
   - `config.office.com`
- Copy the OfflineUpdateExporter tool and its dependencies to the internet connected WSUS server.
  - The tool and its dependencies are in the **&lt;ConfigMgrInstallDir>/tools/OfflineUpdateExporter** directory.
- The user running the tool must be part of the **WSUS Administrators** group.
- The directory created to store the Office update metadata and content should have appropriate access control lists (ACLs) to secure the files.
    - This directory must also be empty.
- Data being moved from the online WSUS server to the disconnected environment should be moved securely.

### Synchronize then decline unneeded Office 365 updates

1. On your internet connected WSUS, open the WSUS console.
1. Select **Options** then **Products and Classifications**.
1. In the **Products** tab, select **Office 365 Client** and select **Updates** in the **Classifications** tab.
[![Products and classifications for Office 365 updates in WSUS](../../media/4065163-o365-updates-product-classification.png)](../../media/4065163-o365-updates-product-classification.png#lightbox)
1. Go to **Synchronizations** and select **Synchronize Now** to get the Office 365 updates into WSUS.
1. When the synchronization completes, decline any Office 365 updates that you don't want to deploy with Configuration Manager.
   - Declining unwanted Office 365 updates in WSUS doesn't stop them from being exported during a wsusuitl.exe export, but it does stop the OfflineUpdateExporter tool from downloading the content for them.
   - Create a [new update view in WSUS](https://docs.microsoft.com/windows-server/administration/windows-server-update-services/manage/viewing-and-managing-updates#to-create-a-new-update-view-on-wsus) to easily see and decline unneeded Office 365 updates in WSUS.

### Exporting the Office 365 updates

1. Copy the OfflineUpdatExporter folder from Configuration Manager to the internet connected WSUS server.
    - The tool and its dependencies are in the **&lt;ConfigMgrInstallDir>/tools/OfflineUpdateExporter** directory.
1. From a command prompt on the internet connected WSUS server, run the tool with the following usage: **OfflineUpdateExporter.exe -O -D &lt;destination path>**
   - The **OfflineUpdateExporter** tool does the following:
      - Connects to WSUS
      - Reads the Office 365 update metadata in WSUS
      - Downloads the content and any additional metadata needed by the Office 365 updates to the destination folder
1. 



### Import Office 365 updates


### Known issues

- Proxy configuration isn't natively built into the tool. If proxy is set in the Internet Options on the server where the tool is running, in theory it will be used and should function properly.
   - From a command prompt, run `netsh winhttp show proxy` to see the configured proxy.
- Only local paths work for the O365OflBaseUrlConfigured property. Network paths are planned in the future.
- Currently, content will be downloaded for all Office 365 languages. Each update can have approximately 10 GB of content.

### Modify O365OflBaseUrlConfigured property

```vbs
On Error Resume Next

'***  Define string variables for device, device Resource ID and user of interest
'*** Change SERVER1.CONTOSO.COM to your server name, S01 to your site code, D:\Office365updates\content to your path

Class_Name = 		"SMS_SCI_Component"
Class_ItemName =	"SMS_WSUS_CONFIGURATION_MANAGER|SERVER1.CONTOSO.COM"
Class_ItemType =	"Component"
Property_Name = 	"O365OflBaseUrlConfigured"
Property_SiteCode = 	"S01"
DesiredValue =		D:\Office365updates\content

'***  Check parameters - we need the provider server name and the site code

set args=wscript.arguments

If args.Count = 2 then
	SMSProviderServer = UCASE(Wscript.Arguments(0))
	SiteCode = UCASE(Wscript.Arguments(1))
Else
	wscript.Echo "Incorrect command line arguments." & vbCrLf & "Usage: cscript /nologo O365OflBaseUrlConfigured.vbs <smsproviderserver> <sitecode>" & vbCrLf & "Example: cscript /nologo O365OflBaseUrlConfigured.vbs SERVER1 S01 > O365OflBaseUrlConfigured.txt" & vbCrLf
	WScript.Quit(1)
End If


'***  Connect to the provider - report the error and terminate on failure

SMSProviderServer = "\\" + SMSProviderServer + "\"
Set ObjSvc = GetObject("winmgmts:" & "{impersonationLevel=Impersonate,authenticationLevel=Pkt}!" & SMSProviderServer & "root\sms\site_" & SiteCode)

If Err.Number <> 0 Then
	wscript.Echo "Failed to connect to provider server with code: " & Err.Number & ".  Aborting!"
	WScript.Quit(2)
End If

'***  Get the desired instance of the class

Set objInst = ObjSvc.Get(Class_Name & ".ItemName='" & Class_ItemName & "',ItemType='" & Class_ItemType & "',SiteCode='" & Property_SiteCode &"'")

If Err.Number <> 0 Then
	WScript.Echo "Failed to open desired object with error code " & Err.Number & " (" & Err.Description & ").  Aborting!"
	WScript.Quit(3)
End If
```