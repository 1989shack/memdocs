---
author: mestew
ms.author: mstewart
ms.prod: configuration-manager
ms.technology: configmgr-other
ms.topic: include
ms.date: 09/26/2019
ms.collection: M365-identity-device-management
---

## <a name="bkmk_Azure-migration"></a> Extend and migrate on-premises Configuration Manager environments to Microsoft Azure
<!--3556022-->

The **Extend and Migrate ConfigMgr Site System roles to Azure** tool will help you to programmatically, create Azure VMs and install Configuration Manager Site system roles like passive site server, MPs, and DPs, with default settings in Azure. Once the new roles are created and validated by you, you can keep them as additional site systems for high availability, or remove the site system role from on-premises and move the role to Azure only.

This tool provides automation and guidance to help you with migrating on-premise hierarchy to Azure, including:

- Getting your Azure resource ready
- Getting your passive site server ready
- Getting your site database ready
- Getting your site system roles ready

### Prerequisites

- An Azure subscription
- Azure virtual network with ExpressRoute gateway
- Configuration Manager version 1806 or higher
- A standalone environment and not in a hierarchy
  - CAS and hierarchy environments are not currently supported.
- The tool should only be install and run on the primary site server
- The user running the tool needs to be a Configuration Manager Admin and have administrator rights on the primary site server.
- To add a passive server, the primary site must:
  - Use a remote site database
  - Use a remote content library


### Run the tool and connect to Azure

1. Run the **Extend and Migrate Configuration Manager Site System roles to Azure** tool. By default, it is located in %program files\XXXX\XXXX\XXXX.
1. When the tool finishes loading, click either **Next** or on the **Azure Information** tab.
1. Choose your **Azure Environment** in the **Azure Information** tab.
    - You'll need your Azure account information and an ExpressRoute gateway before you can proceed after this step.
    - You may need to add https://*.microsoft.com to  your trusted websites list to sign in correctly.
   ![Azure Information tab in the Extend and Migrate tool](../../media/3556022-azure-information-tab.png)
1. Click **Sign In** and type in your Azure account information. Signing in will require two-factor authentication.
1. Once you're signed in, select your **Subscription ID** and **Virtual Network**. Only networks with an ExpressRoute gateway are listed.
1. Click **Next** to start the provisioning and configuration steps.

### Get the Azure resources and your passive site server ready

1. In the **Site Server High Availability** tab, click **Check** to begin evaluating your environment's readiness. To add a passive site server, the primary site must:
    - Use a remote site database
    - Use a remote content library
1. If any of the checks fail, click on **More Details** to determine how to remediate the problem. For more information about high availability prerequisites, see [Site server high availability](/sccm/core/servers/deploy/configure/site-server-high-availability).
1. Click **Create a site server in Azure** and fill in the following fields:

    |Name|Description|
    |---|---|
    |Subscription|Read only. Shows the subscription name and ID.|
    |Resource group| Lists resource groups. If needed, create a new one from the [Azure Portal](https://portal.azure.com).|
    |Location| Read only. Determined by your virtual network’s location|
    |VM Size|Choose a size from the list to fit your workload. Standard_DS3_v2 is recommended|
    |Operating system|Read only. The tool uses Windows Server 2019|
    |Disk type|Read only. Premium SSD is used for performance.|
    |Virtual network|Read only.|
    |Subnet|Pick the subnet from the list. If needed, create a new one from the [Azure Portal](https://portal.azure.com).|
    |Machine name|Input the machine name of the passive site server. It’s also the same name shown in the [Azure Portal](https://portal.azure.com).|
    |Local admin username|The Azure VM creates a local user before joining the domain. This is the the username for the local user.|
    |Local admin password|The Azure VM creates a local user before joining the domain. This is the the password for the local user. To protect the password during Azure deployment, store the password as a secret in [Azure Key Vault](https://docs.microsoft.com/azure/key-vault/key-vault-overview). Then, use the reference here. If needed, create a new one from the [Azure Portal](https://portal.azure.com).|
    |Domain FQDN|The fully qualified domain name used for joining the domain. By default, the tool get this from your current machine.|
    |Domain username|Domain user allowed to join the domain. By default, the tool gets the current logged on username.|
    |Domain password|Domain password to join the domain. The tool verifies it after you click the **Start** button. To protect the password during Azure deployment, store the password as a secret in [Azure Key Vault](https://docs.microsoft.com/azure/key-vault/key-vault-overview). Then, use the reference here. If needed, create a new one from the [Azure Portal](https://portal.azure.com).|
    |Domain DNS IP|Used for joining the domain. By default, the tool gets the current DNS  from your current machine.|
    |Type|Read only. It shows “Passive Site Server” as the type.|

1. Click **Start** to start the provisioning of the virtual machine in Azure. You can check the deployment status from the **Deployments in Azure** tab. Click **Refresh** to get the lastest deployment status.
   - You can use the [Azure Portal](https://portal.azure.com) to check the status, easily find the errors, and determine potential fixes.

1. Once the deployment is finished, go to your SQL servers. Grant permissions for this new Azure virtual machine. For more information about the needed permissions, click the **Prerequisites** link in the **Site Server High Availability** tab.
1. To add the Azure virtual machine as passive site server, click **Add site server in passive mode** from the **Site Server High Availability** tab.
1. Once the passive site server is added, you'll see the status in the **Site Server High Availability** tab. Click **Next** when it's done to get to the **Site Database** tab. 

   ![Passive site server added to Site Server High Availability tab](../../media/3556022-site-server-passive-mode.png)


### Getting the site databaase ready

