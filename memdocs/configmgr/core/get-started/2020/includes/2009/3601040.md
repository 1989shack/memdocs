---
author: aczechowski
ms.author: aaroncz
ms.prod: configuration-manager
ms.technology: configmgr-core
ms.topic: include
ms.date: 09/10/2010
---

## <a name="bkmk_cmgvmss"></a> Cloud management gateway with virtual machine scale set

<!--3601040-->

Based on your [UserVoice feedback](https://configurationmanager.uservoice.com/forums/300492-ideas/suggestions/17404900-cloud-management-gateway-as-csp), cloud management gateway (CMG) deployments now use virtual machine scale sets in Azure. This change introduces support for Azure Cloud Solution Provider (CSP) subscriptions.

Except for the following aspects, the configuration, operation, and functionality of the CMG remains the same:

- A new prerequisite is to register the following resource providers in your Azure subscription:

  - Microsoft.KeyVault
  - Microsoft.Storage
  - Microsoft.Network
  - Microsoft.Compute

  For more information, see [Azure resource providers and types](/azure/azure-resource-manager/management/resource-providers-and-types).

- When you create a CMG in the Configuration Manager console, the default option to deploy the cloud service is as a **Virtual machine scale set**. If necessary, you can still select **Cloud service (classic)** to use the existing Azure Resource Manager deployment.

- For a CMG deployment to a virtual machine scale set, the service name is different. This name is from the [CMG server authentication certificate](../../../../clients/manage/cmg/certificates-for-cloud-management-gateway.md#bkmk_serverauth).

  - With the previous Azure Resource Manager deployment option, the service name is in the **cloudapp.net** domain. For example, **GraniteFalls.CloudApp.Net**.

  - With a virtual machine scale set, the service name uses the **cloudapp.azure.com** domain along with the region. For example, **GraniteFalls.EastUS.CloudApp.Azure.Com** for a deployment in the **East US** Azure region.

- The CMG connection point only communicates with the virtual machine scale set in Azure over HTTPS. It doesn't require TCP-TLS ports 10140-10155 to build the CMG communication channel.

If you already have an existing CMG deployment using Azure Resource Manager, you don't have to [redeploy the service](../../../../clients/manage/cmg/setup-cloud-management-gateway.md#redeploy-the-service). This new deployment method is primarily to support CSP customers to use the CMG. If you do redeploy the service, since the service name changes, you may need a new CMG server authentication certificate.

For more general information on the cloud management gateway, see [Plan for the CMG](../../../../clients/manage/cmg/plan-cloud-management-gateway.md).

### Preview limitations for CMG with virtual machine scale sets

The following CMG configurations are currently not supported in this release:

- Azure US Government Cloud

- Enforce TLS 1.2
